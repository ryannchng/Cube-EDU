<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Course Averages</title>
	<style>
		:root {
			--bg: #f6f9ff;
			--card: #ffffff;
			--text: #1f2937;
			--muted: #64748b;
			--border: #dbe5f1;
			--accent: #2563eb;
		}

		* { box-sizing: border-box; }

		body {
			margin: 0;
			min-height: 100vh;
			font-family: "Segoe UI", Tahoma, sans-serif;
			color: var(--text);
			background: linear-gradient(180deg, #edf4ff 0%, var(--bg) 100%);
			padding: 24px;
		}

		.container {
			max-width: 980px;
			margin: 0 auto;
		}

		.side-nav {
			position: fixed;
			right: 18px;
			top: 18px;
			z-index: 20;
			background: #fff;
			border: 1px solid var(--border);
			border-radius: 12px;
			padding: 10px;
			display: flex;
			align-items: center;
			gap: 8px;
			box-shadow: 0 8px 20px rgba(15, 23, 42, 0.12);
		}

		.nav-select {
			border: 1px solid var(--border);
			border-radius: 8px;
			padding: 8px;
			font-size: 0.9rem;
			color: var(--text);
			background: #fff;
			min-width: 165px;
		}

		.go-btn {
			border: 0;
			border-radius: 8px;
			padding: 8px 12px;
			font-size: 0.85rem;
			font-weight: 700;
			color: #fff;
			background: var(--accent);
			cursor: pointer;
		}

		.card {
			background: var(--card);
			border: 1px solid var(--border);
			border-radius: 12px;
			padding: 24px;
			box-shadow: 0 10px 28px rgba(15, 23, 42, 0.08);
		}

		h1 {
			margin: 0 0 8px;
			font-size: 1.8rem;
		}

		.subtitle {
			margin: 0 0 16px;
			color: var(--muted);
		}

		.table-wrap {
			overflow-x: auto;
		}

		table {
			width: 100%;
			border-collapse: collapse;
			border: 1px solid var(--border);
			border-radius: 10px;
			overflow: hidden;
			min-width: 700px;
		}

		th,
		td {
			padding: 10px 12px;
			border-bottom: 1px solid var(--border);
			text-align: left;
			vertical-align: top;
			font-size: 0.92rem;
		}

		th {
			background: #eff6ff;
			font-size: 0.85rem;
			text-transform: uppercase;
			letter-spacing: 0.03em;
		}

		tr:last-child td {
			border-bottom: 0;
		}

		.empty {
			color: var(--muted);
		}

		.assignment-row td {
			background: #f8fbff;
			border-bottom: 1px solid var(--border);
		}

		.assignment-wrap {
			display: grid;
			gap: 8px;
		}

		.assignment-title {
			font-size: 0.82rem;
			font-weight: 700;
			text-transform: uppercase;
			color: #334155;
			letter-spacing: 0.03em;
		}

		.assignment-list {
			margin: 0;
			padding-left: 18px;
			display: grid;
			gap: 4px;
		}

		.assignment-item {
			display: flex;
			align-items: center;
			justify-content: space-between;
			gap: 8px;
		}

		.assignment-item-text {
			color: #334155;
		}

		.assignment-empty {
			color: var(--muted);
			font-size: 0.9rem;
		}

		.assignment-controls {
			display: flex;
			gap: 8px;
			flex-wrap: wrap;
		}

		.assignment-input {
			flex: 1;
			min-width: 220px;
			border: 1px solid var(--border);
			border-radius: 8px;
			padding: 8px 10px;
			font-size: 0.88rem;
		}

		.assignment-btn {
			border: 0;
			border-radius: 8px;
			padding: 8px 10px;
			font-size: 0.82rem;
			font-weight: 700;
			color: #fff;
			background: var(--accent);
			cursor: pointer;
		}

		.assignment-delete {
			border: 0;
			border-radius: 7px;
			padding: 6px 9px;
			font-size: 0.75rem;
			font-weight: 700;
			color: #fff;
			background: #ef4444;
			cursor: pointer;
		}

		@media (max-width: 860px) {
			body {
				padding-top: 88px;
			}

			.side-nav {
				left: 12px;
				right: 12px;
				top: 12px;
			}

			.nav-select {
				flex: 1;
			}
		}
	</style>
	<link rel="stylesheet" href="modern.css" />
</head>
<body>
	<nav class="top-tabs" aria-label="Main navigation">
		<a class="top-tab" href="index.html">Planner</a>
		<a class="top-tab active" href="coursework.html">Coursework</a>
		<a class="top-tab" href="money.html">Money</a>
		<a class="top-tab" href="habit.html">Habit</a>
	</nav>

	<main class="container">
		<section class="card">
			<h1>Course Averages</h1>
			<p class="subtitle">Generated from pasted Student Reports HTML.</p>
			<div class="table-wrap">
				<table id="coursesTable">
					<thead>
						<tr>
							<th>Course Code</th>
							<th>Course Name</th>
							<th>Date Range</th>
							<th>Current Average / Mark</th>
							<th>Details</th>
						</tr>
					</thead>
					<tbody id="coursesTableBody"></tbody>
				</table>
			</div>
			<p id="emptyState" class="empty"></p>
		</section>
	</main>

	<script>
		const pageSelect = document.getElementById('pageSelect');
		const goPageBtn = document.getElementById('goPageBtn');
		const coursesTableBody = document.getElementById('coursesTableBody');
		const emptyState = document.getElementById('emptyState');

		function goToSelectedPage() {
			const selected = pageSelect?.value;
			if (!selected) return;
			window.location.href = selected;
		}

		function loadCourses() {
			try {
				const raw = localStorage.getItem('courseAveragesData');
				const parsed = raw ? JSON.parse(raw) : [];
				return Array.isArray(parsed)
					? parsed.map((course) => ({
							...course,
							assignments: Array.isArray(course.assignments) ? course.assignments : [],
						}))
					: [];
			} catch {
				return [];
			}
		}

		function saveCourses(courses) {
			localStorage.setItem('courseAveragesData', JSON.stringify(courses));
		}

		function escapeHtml(value) {
			return String(value)
				.replace(/&/g, '&amp;')
				.replace(/</g, '&lt;')
				.replace(/>/g, '&gt;')
				.replace(/"/g, '&quot;')
				.replace(/'/g, '&#39;');
		}

		function renderAssignments(course, courseIndex) {
			const assignments = Array.isArray(course.assignments) ? course.assignments : [];
			const itemsHtml = assignments.length
				? assignments
						.map((assignment, assignmentIndex) => `
							<li class="assignment-item">
								<span class="assignment-item-text">${escapeHtml(assignment)}</span>
								<button class="assignment-delete" data-course-index="${courseIndex}" data-assignment-index="${assignmentIndex}" type="button">Delete</button>
							</li>
						`)
						.join('')
				: '<p class="assignment-empty">No assignments added for this course yet.</p>';

			return `
				<div class="assignment-wrap">
					<div class="assignment-title">Assignments</div>
					${assignments.length ? `<ul class="assignment-list">${itemsHtml}</ul>` : itemsHtml}
					<div class="assignment-controls">
						<input class="assignment-input" type="text" data-assignment-input="${courseIndex}" placeholder="Add assignment for this course" />
						<button class="assignment-btn" type="button" data-add-assignment="${courseIndex}">Add Assignment</button>
					</div>
				</div>
			`;
		}

		function renderCourses() {
			const courses = loadCourses();
			coursesTableBody.innerHTML = '';

			if (!courses.length) {
				emptyState.textContent = 'No generated course data found. Go to Coursework and generate this page first.';
				return;
			}

			emptyState.textContent = '';

			courses.forEach((course, courseIndex) => {
				const row = document.createElement('tr');
				const values = [
					course.code || '',
					course.courseName || '',
					course.dateRange || '',
					course.mark || '',
					course.schedule || '',
				];

				values.forEach((value) => {
					const cell = document.createElement('td');
					cell.textContent = value;
					row.appendChild(cell);
				});
				coursesTableBody.appendChild(row);

				const assignmentRow = document.createElement('tr');
				assignmentRow.className = 'assignment-row';
				const assignmentCell = document.createElement('td');
				assignmentCell.colSpan = 5;
				assignmentCell.innerHTML = renderAssignments(course, courseIndex);
				assignmentRow.appendChild(assignmentCell);
				coursesTableBody.appendChild(assignmentRow);
			});
		}

		function addAssignment(courseIndex) {
			const courses = loadCourses();
			const input = document.querySelector(`[data-assignment-input="${courseIndex}"]`);
			if (!input || !courses[courseIndex]) return;

			const value = input.value.trim();
			if (!value) return;

			courses[courseIndex].assignments.push(value);
			saveCourses(courses);
			renderCourses();
		}

		function deleteAssignment(courseIndex, assignmentIndex) {
			const courses = loadCourses();
			if (!courses[courseIndex]) return;

			courses[courseIndex].assignments = courses[courseIndex].assignments.filter((_, i) => i !== assignmentIndex);
			saveCourses(courses);
			renderCourses();
		}

		coursesTableBody?.addEventListener('click', (event) => {
			const addTarget = event.target.closest('[data-add-assignment]');
			if (addTarget) {
				addAssignment(Number(addTarget.getAttribute('data-add-assignment')));
				return;
			}

			const deleteTarget = event.target.closest('.assignment-delete');
			if (deleteTarget) {
				const courseIndex = Number(deleteTarget.getAttribute('data-course-index'));
				const assignmentIndex = Number(deleteTarget.getAttribute('data-assignment-index'));
				deleteAssignment(courseIndex, assignmentIndex);
			}
		});

		coursesTableBody?.addEventListener('keydown', (event) => {
			const input = event.target;
			if (!(input instanceof HTMLInputElement)) return;
			if (event.key !== 'Enter') return;
			const courseIndex = Number(input.getAttribute('data-assignment-input'));
			addAssignment(courseIndex);
		});

		goPageBtn?.addEventListener('click', goToSelectedPage);
		pageSelect?.addEventListener('change', goToSelectedPage);
		renderCourses();
	</script>
</body>
</html>
